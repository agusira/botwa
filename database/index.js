import{existsSync,readFileSync,writeFileSync}from"fs";import path from"path";export class DatabaseJson{constructor(){this.db={config:{},groups:{},users:{}};let dir=path.join(import.meta.dirname,"files/");this.files={config:path.join(dir,"config.json"),groups:path.join(dir,"groups.json"),users:path.join(dir,"users.json")};this.initDB()}initDB(){Object.keys(this.files).forEach(file=>{if(existsSync(this.files[file])){console.log("File %s is Ok",file);this.db[file]=JSON.parse(readFileSync(this.files[file]))}else{console.log("Creating file %s.json",file);writeFileSync(this.files[file],"{}");this.db[file]=JSON.parse(readFileSync(this.files[file]))}});let cfg=this.db.config;cfg.author="Agus Irawan";cfg.ownerNumber=["62895359263399"];if(!("public"in cfg))cfg.public=false}save(){Object.keys(this.files).forEach(file=>{writeFileSync(this.files[file],JSON.stringify(this.db[file],null,2))})}addGroup(group){if(!group||!group.endsWith("@g.us"))return 0;if(this.checkGroup(group))return 2;this.db.groups[group]={mute:true,welcome:false};return 1}checkGroup(group){return!!this.db.groups?.[group]}getGroup(group){if(!group||!group.endsWith("@g.us"))return 0;return this.db.groups[group]}setGroup(group,[obj,value]){if(!group||!group.endsWith("@g.us"))return 0;if(!this.checkGroup(group))return 3;this.db.groups[group][obj]=value;return 1}checkUser(user){return!!this.db.users?.[user]}addUser(user){if(!user)return 0;if(this.checkUser(user))return 2;this.db.users[user]={premium:false,limit:100,warning:0,isBan:false};return 1}setUser(user,[obj,value]){if(!user)return 0;if(!this.checkUser(user))return 3;this.db.users[user][obj]=value;return 1}getUser(user){if(!user)return 0;return this.db.users[user]}}

import{existsSync,readFileSync,writeFileSync}from"fs";import path from"path";export class DatabaseJson{constructor(){this.db={config:{},groups:{},users:{}};let dir=path.join(import.meta.dirname,"files/");this.files={config:path.join(dir,"config.json"),groups:path.join(dir,"groups.json"),users:path.join(dir,"users.json")};this.initDB()}initDB(){Object.keys(this.files).forEach(file=>{if(existsSync(this.files[file])){console.log("File %s is Ok",file);this.db[file]=JSON.parse(readFileSync(this.files[file]))}else{console.log("Creating file %s.json",file);writeFileSync(this.files[file],"{}");this.db[file]=JSON.parse(readFileSync(this.files[file]))}});let cfg=this.db.config;cfg.author="Agus Irawan";cfg.ownerNumber=["62895359263399"];if(!("public"in cfg))cfg.public=false}save(){Object.keys(this.files).forEach(file=>{writeFileSync(this.files[file],JSON.stringify(this.db[file],null,2))})}get config(){return this.db.config}set config({key,value}){this.db.config[key]=value}addGroup(group){if(!group||!group.endsWith("@g.us"))return 0;if(this.checkGroup(group))return 2;this.db.groups[group]={mute:true,welcome:false};return 1}checkGroup(group){return!!this.db.groups?.[group]}get groups(){return this.db.groups}set groups({groupId,attr:[key,value]}){this.db.groups[groupId][key]=value}checkUser(user){return!!this.db.users?.[user]}addUser(user){if(!user)return 0;if(this.checkUser(user))return 2;this.db.users[user]={premium:false,limit:100,warning:0,isBan:false};return 1}set users({userId,attr:[key,value]}){this.db.users[userId][key]=value}get users(){return this.db.users}}export const db=new DatabaseJson;
